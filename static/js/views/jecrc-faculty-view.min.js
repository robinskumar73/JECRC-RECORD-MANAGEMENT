var app=app||{};app.Views=app.Views||{};app.Global=app.Global||{};app.Global.DepartmentPresentAlready=false;app.Views.Department=Backbone.View.extend({el:$("#DepartmentCreate"),events:{"click #create-dept":"createDepartment","keypress #Department":"handleKeyPress","click #Dept-Cancel":"cancel_department"},createDepartment:function(){app.Global.DepartmentPresentAlready=false;app.Global.selDeptModel=null;value=$("#Department").val();if(value===""){return null}$($("#DepartmentCreate ").children()).addClass("hide");$("#Dept-Cancel").removeClass("hide");$("#dept-screen").removeClass("hide");$("a.navbar-text navbar-right jecrc-nav-dept").click(function(e){e.preventDefault()});$("#AddSemester").removeClass("hide");$("#infoScreen").removeClass("hide");$(".infoScreenHeader").html(value);if(app.Global.Department.findWhere({name:value})!==undefined){app.Global.selDeptModel=app.Global.Department.findWhere({name:value});app.Global.DepartmentPresentAlready=true;return null}app.Global.Department.create({name:value},{error:function(e,t){displayMessage("Error saving department..");revertDeptToInitial()},success:function(e){console.log("Successfully added department to database..");displayMessage("Successfully added department to database..");app.Global.selDeptModel=e}})},render:function(){$("#nav-dept-bar").html("");var e=app.Global.Department.length;for(var t=0;t<e;t++){$("#nav-dept-bar").append('<li><a href="#department/'+app.Global.Department.at(t).get("name")+'"  >'+app.Global.Department.at(t).get("name")+"</a></li>");$("#collapse-nav-bar").append('<li class="jecrc-nav-hide"><a href="#department/'+app.Global.Department.at(t).get("name")+'"  >'+app.Global.Department.at(t).get("name")+"</a></li>")}return this},handleKeyPress:function(e){var t=e.which;if(t==13){this.createDepartment()}},cancel_department:function(e){e.preventDefault();var t=app.Global.Department.length;if(!app.Global.DepartmentPresentAlready&&app.Global.Department.at(t-1)===app.Global.selDeptModel){var n=app.Global.Department.pop();var r=$("#nav-dept-bar").children().length;$($("#nav-dept-bar").children()[r-1]).remove()}revertDeptToInitial();hideBatch();hideSection()},initialize:function(){this.listenTo(app.Global.Department,"add",this.displayNavigationBar);this.listenTo(app.Global.Department,"remove",this.removeNavigationBar)},removeNavigationBar:function(e){if(!app.Global.DepartmentPresentAlready){e.destroy({error:function(e,t){displayMessage("Error removing department..");app.Global.Department.add(e)},success:function(e,t){console.log("Successfully deleted department..");displayMessage("Successfully deleted department..")}})}},displayNavigationBar:function(e){value=e.get("name");$("#nav-dept-bar").append('<li><a href="#department/'+value+'"  >'+value+"</a></li>");$("#collapse-nav-bar").append('<li class="jecrc-nav-hide"><a href="#department/'+value+'"  >'+value+"</a></li>")}});var displayMessage=function(e){$("#dept-info-box").removeClass("hide");$("#dept-info-box").html(e);setTimeout(function(){$("#dept-info-box").addClass("hide")},4e3)};var revertDeptToInitial=function(){$("#Department").val("");$($("#DepartmentCreate ").children()).removeClass("hide");$("#Dept-Cancel").addClass("hide");$("#dept-screen").addClass("hide");$("a.navbar-text navbar-right jecrc-nav-dept").bind("click");$("#AddSemester").addClass("hide")};var dept_views=new app.Views.Department;app.Views.Semester=Backbone.View.extend({el:$("#radio-btn"),events:{"change input[name=options]":"addSemester"},addSemester:function(e){var t=$(".radio:checked").val();app.Global.semester_id=t;var n=app.Global.selDeptModel;var r=n.get("name");this.showSection();this.updateInfoBox(r,t)},showSection:function(){$("#AddSection").removeClass("hide")},updateInfoBox:function(e,t){$(".infoScreenHeader").html(""+t+""+e+"")}});var semesterView=new app.Views.Semester;$(document).on("change","#section-btn input[name=options]",function(){var e=app.Global.semester_id;var t=$(this).val();app.Global.section_id=t;var n=app.Global.selDeptModel;var r=n.get("name");showBatch();$(".infoScreenHeader").html(e+r+t)});var showBatch=function(){$("#AddBatches").removeClass("hide")};var hideBatch=function(){$("#AddBatches").addClass("hide");$("#publish-batch").addClass("hide")};var hideSection=function(){$("#AddSection").addClass("hide")};app.Views.Batch=Backbone.View.extend({el:$("#AddBatches"),events:{"click .dept-check ":"onClick"},onClick:function(e){setTimeout(this.count)},count:function(){var e=[];$(".infoScreenSubHeader").html("");$(".dept-check").each(function(t,n){if($(n).hasClass("active")){e.push($(n).data("wat"));showinfoScreenSubHeader();var r=app.Global.selDeptModel;var i=r.get("name");$(".infoScreenSubHeader").append('<span class="h4">'+app.Global.semester_id+i+app.Global.section_id+$(n).data("wat")+"</span>")}});app.Global.Batches=e}});var batch=new app.Views.Batch;var showinfoScreenSubHeader=function(){$(".infoScreenSubHeader").removeClass("hide");$("#publish-batch").removeClass("hide")};$(document).on("click","#publish-batch",function(e){var t=app.Global.Batches;var n=app.Global.semester_id;var r=app.Global.selDeptModel;var i=app.Global.section_id;$(".dept-check").each(function(e,t){if($(t).hasClass("active")){var s=$(t).data("wat");app.Global.Branch.create({department_id:r.get("id"),semester_id:n,section_name:i,batch_id:s},{error:function(e,t){displayMessage("Error saving Branch..");$("#Dept-Cancel").click()},success:function(e){displayMessage("Successfully added branch to database..");hideBatch();hideSection();$("#infoScreen").addClass("hide");$("#AddSemester").addClass("hide");$("#dept-screen").addClass("hide");$("#Dept-Cancel").addClass("hide");$("#Department").removeClass("hide");$("#Department").val("");$("#create-dept").removeClass("hide");$("#DepartmentCreate").removeClass("hide");$("span.twitter-typeahead").removeClass("hide")}})}})});app.Views.periodEntry=Backbone.View.extend({tagName:"div",className:"col-md-12",initialize:function(){app.Global.Router.currentView=this;this.childViews=[];if(this.collection.length===0){var e=faculty.first_name+" "+faculty.last_name;this.name=getInitialFacultyName(e);var t=getTodayDate();this.day=getDay(t);this.date=convertDate(t);this.template=_.template($("#faculty-table-data").html());this.template=this.template({day:this.day,date:this.date,faculty:this.name})}else{this.lab={row0:null,row1:null,row2:null};this.LabPeriodAdd=[];this.periodList=$("<tr/>");this.subjectList=$("<tr/>");this.strengthList=$("<tr/>");this.teacherList=$("<tr/>");this.date=this.collection[0].get("date");this.department_name=app.Global.Department.findWhere({id:this.collection[0].get("department_id")}).get("name");this.section_name=this.collection[0].get("section_name");this.semester_id=this.collection[0].get("semester_id");this.day=getDay(this.date);this.parse_date=convertDate(this.date)}},render:function(){$(this.el).empty();if(this.collection.length===0){this.$el.append(this.template);return this}this.addBody(this.day,this.parse_date);var e=$("<thead />");var t=$("<tbody />");e.append(this.periodList);this.table.append(e);t.append(this.subjectList);t.append(this.strengthList);t.append(this.teacherList);this.addToList(this.collection);this.table.append(t);return this},addBody:function(e,t){this.$el.append("<h4 class='report-dept-info'>"+this.semester_id+" "+this.department_name+"</h4>");this.$el.append("<span class='report-dept-info'>"+this.section_name+"</span><hr class='report-dept-info' style='margin-top:0px;margin-bottom:0px;'>");this.$el.append("<h4 class='log_day'>"+e+"</h4>");this.$el.append("<span class='log_date'>"+t+"</span>");var n=$("<div class='col-md-12 jecrc-stats' />");var r=$("<div class='table-responsive'/>");this.table=$("<table class='table table-striped'/>");n.append(r);r.append(this.table);this.$el.append(n);this.$el.append("<br />")},addToList:function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.get("lab")==="0"){for(var r=0;r<n.get("period").length;r++){this.periodList.append("<th>"+n.get("period")[r]+"</th>")}var i=n.get("period").length;this.subjectList.append("<td colspan='"+i+"' >"+n.get("subject_name")+"</td>");this.strengthList.append("<td  colspan='"+i+"' >"+n.get("strength")+"</td>");this.teacherList.append("<td class='faculty_name_tuple' data-toggle='tooltip' data-placement='top' title='Faculty :  "+n.get("faculty_name").toUpperCase()+"' colspan='"+i+"' >"+getInitialFacultyName(n.get("faculty_name"))+"</td>")}else{var s=null;var o=[];for(var u=0;u<this.LabPeriodAdd.length;u++){var a=this.LabPeriodAdd[u].lab;var f=this.LabPeriodAdd[u].period;var l=n.get("period");if($(f).not(l).length==0&&$(l).not(f).length==0){s=a;o=this.LabPeriodAdd[u].id;break}}if(s===null){var a={row0:null,row1:null,row2:null};var f=n.get("period");s=a;var c=app.Global.randomNumber(999,999999);var h=app.Global.randomNumber(999,999999);var p=app.Global.randomNumber(999,999999);o=[c,h,p];this.LabPeriodAdd.push({period:f,lab:a,id:o})}if(s["row0"]===null){for(var r=0;r<n.get("period").length;r++){this.periodList.append("<th>"+n.get("period")[r]+"</th>")}}var d=n.get("subject_name");var v=n.get("section_name");var m=n.get("batch");var g=n.get("strength");var y=getInitialFacultyName(n.get("faculty_name"));var i=n.get("period").length;if(s["row0"]===null){row="0";this.subjectList.append("<td id='"+o[0]+"'  colspan='"+i+"'  rowspan='"+row+"'  >"+d+" -  "+v+m+" Batch  -"+g+" - "+y+"</td>");this.strengthList.append("<td id='"+o[1]+"'  colspan='"+i+"'  rowspan='"+"1"+"'  >"+" -------  "+"</td>");this.teacherList.append("<td  id='"+o[2]+"'  colspan='"+i+"'  rowspan='"+"2"+"'  >"+" ------- "+"</td>");s["row0"]=true}else if(s["row1"]===null){var b=this.strengthList.find("td#"+o[1]);$(b).html(d+" -  "+v+m+" Batch  -"+g+" - "+y);row="1";s["row1"]=true}else{row="2";var b=this.teacherList.find("td#"+o[2]);$(b).html(d+" -  "+v+m+" Batch  -"+g+" - "+y);s["row2"]=true;s["row0"]=null;s["row1"]=null;s["row2"]=null}}}}});app.Views.FacultyEntry=Backbone.View.extend({initialize:function(){console.log("inside app.Views.FacultyEntry constructor");$(this.el).empty();app.period=this.model;this["dept_name"]=this.model.get("department_name");this["dept_id"]=this.model.get("department_id");this["semester_id"]=this.model.get("semester_id");this["section_name"]=this.model.get("section_name");this.Template=_.template($("#faculty-entry-form").html());this.form=this.Template({department:this.dept_name});var e=faculty.first_name+" "+faculty.last_name;this.FacultyName=getInitialFacultyName(e);if(this.collection.length){this.days_entry_id=this.collection.at(0).get("days_entry_id")}else{this.days_entry_id=""}},events:{"click #lab-label":"displayBatch","click #class-label":"handleClassButtonClick","click #faculty_save_button":"saveEntry","click #faculty_reset_button":"resetEntryValue"},displayBatch:function(){$("#jecrc-batch-entry").removeClass("hide")},handleClassButtonClick:function(){$("#jecrc-batch-entry").addClass("hide")},render:function(){$(this.el).empty();$(this.el).append(this.form);var e=$(this.$el).find("#jecrc-subject-entry");this.autoSelect=customSubjectSelectize(e);return this},getPeriod:function(){var e=[];$(".dept-check").each(function(t,n){if($(n).hasClass("active")){e.push($(n).data("wat"))}});return e},getLab:function(){if($("#class").attr("checked")===undefined){return 1}else{return 0}},setValue:function(){var e=this.$el.find("#faculty_save_button");var t=this.$el.find("#faculty_reset_button");$(e).remove();$(t).remove();var n=this.$el.find(".jecrc-stats");$(n).removeClass("jecrc-stats");if(this.model.get("subject_name")){var r=this.autoSelect[0].selectize;r.addOption({id:null,subject:this.model.get("subject_name")});r.addItem(this.model.get("subject_name"))}if(parseInt(this.model.get("lab"))===1){var i=this.$el.find("#lab-label");$(i).addClass("active");var s=this.$el.find("#lab");$(s).attr("checked","checked");var o=this.$el.find("#jecrc-batch-entry input");var u=this.$el.find("#jecrc-batch-entry");$(u).removeClass("hide");var a=this;$(o).each(function(e,t){if($(t).val()===a.model.get("batch")){$(t).attr("checked","checked");$($(t).parent()).addClass("active")}})}else{var f=this.$el.find("#class-label");$(f).addClass("active");var l=this.$el.find("#class");$(l).click();$(l).attr("checked","checked")}var c=this.model.get("period");var h=this.$el.find(".dept-check");if(c.length){for(var p=0;p<c.length;p++){$(h).each(function(e,t){if($(t).data("wat")===parseInt(c[p])){$(t).addClass("active")}})}}var d=this.$el.find("#jecrc-strength-entry");$(d).val(this.model.get("strength"))},saveEntry:function(){var e=this.getEntryValue();if(e===null){return null}else{var t=this;if(parseInt(this.update)===0){console.log("Saving the entry!");var n=new app.Model.periodEntry;this.listenTo(n,"invalid",this.validationFailed);n.save(e,{error:function(){t.displayMessage("<strong>Error:</strong> saving entry.",app.Global.alertType[0])},success:function(){t.undelegateEvents();t.displayMessage("<strong>Successfully</strong> saved entry to database.",app.Global.alertType[1]);fetchBranch(t.model.get("department_name"))}});t.destroy_view();app.Global.Router.navigate("department/"+t["dept_name"],{trigger:true})}else{console.log("Updating the data.");var r=t.FacultyLogModel.get("id");t.FacultyLogModel=app.Global.entryLogCollection.get(r);this.model.save(e,{headers:{faculty_id:this.model.get("faculty_id"),facultyLogId:r},error:function(e,n,r){t.undelegateEvents();var i=new Date;var s=i.getTime();t.FacultyLogModel.save({last_update_type:"error",last_updated_time:s},{headers:{faculty_id:t.model.get("faculty_id")},success:function(){console.log("Successfully updated faculty entry to server.")},error:function(){console.log("Error updating faculty entry to server.")}});t.destroy_view()},success:function(n,r,i){var s=r.log;var o=s.id;var u=app.Global.entryLogCollection.get(o);u.set(s);var a=new Date;var f=a.getTime();t.FacultyLogModel.set({last_update_type:"delete",last_updated_time:f,entry_type:"update",sub_info:e.subject_name});t.destroy_view()}});t.destroy_view()}}},destroy_view:function(){this.undelegateEvents();$(this.el).removeData().unbind();this.remove();Backbone.View.prototype.remove.call(this)},validationFailed:function(e){this.displayMessage(e.validationError,app.Global.alertType[3])},resetEntryValue:function(){$("#jecrc-subject-entry").val("");$("#jecrc-strength-entry").val("");$(".btn-group label,.btn-group button").removeClass("active");$("#jecrc-batch-entry").addClass("hide")},getEntryValue:function(){var e=$("#jecrc-subject-entry").val();if(e===""){this.displayMessage("<strong>Error:</strong> Subject cannot be empty.",app.Global.alertType[3]);return null}var t=this.getLab();if(t){batch=$("#jecrc-batch-entry input:checked").val();if(batch===undefined){this.displayMessage("<strong>Error:</strong> You must select a Batch.",app.Global.alertType[3]);return null}}else{batch=null}var n=this.getPeriod();if(n.length===0){this.displayMessage("<strong>Error:</strong> You must select atleast 1 Period.",app.Global.alertType[3]);return null}var r=$("#jecrc-strength-entry").val();if(r===""){this.displayMessage("<strong>Error:</strong> Strength cannot be empty.",app.Global.alertType[3]);return null}var i={subject_name:e,lab:t,period:n,strength:r,faculty_id:faculty["id"],faculty_name:this.FacultyName,batch:batch,department_id:this["dept_id"],semester_id:this["semester_id"],section_name:this["section_name"],days_entry_id:this.days_entry_id};return i},displayMessage:function(e,t){var n=_.template($("#display-info").html());this.display=n({message:e,typeInfo:t});$("#dept-info-box").html(this.display)}});app.Views.Branch=Backbone.View.extend({events:{"click a":"unbindViewOnClick"},unbindViewOnClick:function(){console.log("Unbinding branch view events..");this.undelegateEvents()},initialize:function(){app.Global.Router.currentView=this;if(this.collection.length===0){console.log("returning from branch view initialize");return null}var e=this.collection.at(0).get("department_id");this.dept_name=app.Global.Department.findWhere({id:e}).get("name");this.year=["I YEAR","II YEAR","III YEAR","IV YEAR"];this.branchTemplate=_.template($("#branch-template").html());app.Global.dept=false},render:function(){$(this.el).empty();if(this.collection.length===0){return null}var e={};e.department=this.dept_name;e.years=[];var t=[];var n=0;for(var r=0;r<4;r++){var i={};i.branches=[];var s=this.collection.where({semester_id:String(n+1)});if(s!==undefined&&!$.isEmptyObject(s)){for(var o=0;o<s.length;o++){i.branches.push(s[o])}}s=this.collection.where({semester_id:String(n+1+1)});n=n+1+1;if(s!==undefined&&!$.isEmptyObject(s)){for(o=0;o<s.length;o++){i.branches.push(s[o])}}app.Global.section_added=[];i.branches=this.branchArray(i.branches);i.yearname=this.year[r];t.push(i)}e.years=t;console.log("Inserting to branch el html element..");$(this.$el).html(this.branchTemplate(e));return this},branchArray:function(e){var t=[];for(var n=0;n<e.length;n++){var r={};var i=e[n];var s=i.get("id");var o=i.get("semester_id");var u=i.get("section_name");var a=i.get("batch_id");r.id=s;var f=o+" - "+this.dept_name+" - "+u;if(app.Global.section_added.indexOf(f)===-1){app.Global.section_added.push(f);r.name=f;t.push(r)}}return t}});app.Views.logAlertBox=Backbone.View.extend({initialize:function(){this.childViews=[];this.template=_.template($("#display-info").html());this.listenTo(this.model,"change:last_updated_time",this.destroy_view)},events:{"click #entry-action-btn":"deleteItem","close.bs.alert #dept-display-box":"removeView"},removeView:function(){var e=new Date;var t=e.getTime();this.model.set({last_update_type:"error",last_updated_time:t})},deleteItem:function(){if(this.model.get("entry_type")==="entry"||this.model.get("entry_type")==="update"){var e=this;var t=new app.Model.periodEntry({id:this.model.get("info_entry_id")});var n=this.$el.find("#dept-display-box");$(n).addClass("hide");t.destroy({headers:{faculty_id:e.model.get("faculty_id"),facultyLogId:e.model.get("id")},success:function(t,r,i){$(n).removeClass("hide");var s="Successfully deleted period entry from server!";var o=app.Global.entryLogCollection.get(r.id);if(o===undefined){o.add(r)}else{o.set(r)}e.displayMessage(s,e,app.Global.alertType[1])},error:function(t,r,i){console.log("Error deleting period entry from server!");var s="Error deleting subject entry from server!";$(n).removeClass("hide");e.displayMessage(s,e,app.Global.alertType[3])}})}else if(this.model.get("entry_type")==="subject"){var e=this;var r=new app.Model.Subject({id:this.model.get("info_entry_id")});var n=this.$el.find("#dept-display-box");$(n).addClass("hide");r.destroy({headers:{faculty_id:e.model.get("faculty_id"),facultyLogId:this.model.get("id")},success:function(){var t="Successfully deleted subject entry from server!";$(n).removeClass("hide");e.displayMessage(t,e,app.Global.alertType[1])},error:function(t,r,i){$(n).removeClass("hide");console.log("Error deleting subject entry from server!");var s="<strong>Subject cannot be deleted</strong> . You can only <strong>rename</strong> the subject until all its related subject enteries are deleted.";e.displayMessage(s,e,app.Global.alertType[3])}})}else{}},displayMessage:function(e,t,n){var r=t.$el.find("#dept-display-box");var i=t.$el.find(".delete-info");for(var s=0;s<app.Global.alertType.length;s++){$(r).removeClass(app.Global.alertType[s])}$(r).addClass(n);$(i).empty();$(i).html(e)},render:function(){var e=parseInt(this.delete);if(e===1){var t=_.template($("#display-info").html());var n=_.template($("#entry-log-alert-body").html());deleteAlertBodyElement=n();deleteTemplateBoxElement=t({message:deleteAlertBodyElement,typeInfo:app.Global.alertType[0]});this.$el.append(deleteTemplateBoxElement)}else{var r=new app.Views.alertBody({model:this.model});this.childViews.push(r);this.$el.append(r.el)}return this},destroy_view:function(){console.info("Destroying the modal display 'logAlertBox' view.  ");this.undelegateEvents();$(this.el).removeData().unbind();this.remove();Backbone.View.prototype.remove.call(this)}});app.Views.alertBody=Backbone.View.extend({initialize:function(){this.childViews=[];this.template=_.template($("#alert-modal").html());this.$el.append(this.template());if(this.model.get("entry_type")==="entry"||this.model.get("entry_type")==="update"){if(this.model.get("last_update_type")!=="delete"){this.periodModel=new app.Model.periodEntry({id:this.model.get("info_entry_id")});this.listenTo(this.model,"change:last_updated_time",this.removeView);this.fetchEntryModel(this.periodModel)}}else if(this.model.get("entry_type")==="subject"&&this.model.get("last_update_type")!=="delete"){this.subjectModel=new app.Model.Subject({id:this.model.get("info_entry_id"),subject:this.model.get("sub_info")});this.showSubjectModal(this.subjectModel)}else{console.log("Wrong Entry type");return false}},events:{"click #alert_modal_save_btn":"saveModal","hide.bs.modal #myModal":"removeView","shown.bs.modal #myModal":"addAutoComplete"},showSubjectModal:function(e){var t="Edit subject!";var n='<input type="text" id="jecrc-subject-entry-update" class="form-control jecrc-dept-entry" placeholder="Subject Name">';var r=this.$el.find("#myModalLabel");var i=this.$el.find(".modal-body");$(r).append(t);$(i).append(n)},addAutoComplete:function(){if(this.model.get("entry_type")==="subject"&&this.model.get("last_update_type")!=="delete"){var e=this.$el.find("#jecrc-subject-entry-update");var t=customSubjectSelectize($(e));var n=t[0].selectize;n.addOption(this.subjectModel.toJSON());n.addItem(this.subjectModel.get("subject"))}},addPeriodEntryBody:function(e){r=this.$el.find(".modal-footer");$(r).addClass("modal-form");var t=this.getDepartmentName(e);e.set({department_name:t});var n=new app.Collection.periodEntry(e);this.facultyEntry=new app.Views.FacultyEntry({model:e,collection:n});this.facultyEntry.update=1;this.facultyEntry.FacultyLogModel=this.model;this.childViews.push(this.facultyEntry);this.facultyEntry.render();this.facultyEntry.setValue();var r="Edit your entry!";var i=this.$el.find("#myModalLabel");var s=this.$el.find(".modal-body");$(i).append(r);$(s).append(this.facultyEntry.el)},render:function(){return this},removeView:function(){console.log("Modal is going to hide.Destroying the views.");if(this.facultyEntry!==undefined){this.facultyEntry.destroy_view()}this.destroy_view()},saveModal:function(e){if(this.model.get("entry_type")==="entry"||this.model.get("entry_type")==="update"){console.info("Saving the updated the entry data...");this.facultyEntry.saveEntry()}if(this.model.get("entry_type")==="subject"){console.info("Saving the updated subject..");var t=this.$el.find("#jecrc-subject-entry-update");var n=$(t).val();var r=this;if(n){var i=this.subjectModel.get("subject");this.subjectModel.save({subject:n},{headers:{faculty_id:r.model.get("faculty_id"),Oldsubject:i,facultyLogId:r.model.get("id")},success:function(e){console.log("Successfully updated subject!");r.undelegateEvents();var t=app.Global.entryLogCollection.get(e.get("log").id);t.set(e.get("log"));var n=new Date;var i=n.getTime();r.model.save({last_update_type:"update",last_updated_time:i},{headers:{faculty_id:r.model.get("faculty_id")},error:function(){console.log("Error updating faculty log to server")},success:function(e){console.log("Successfully updated faculty log to server")}})},error:function(){console.log("Error updating the subject to server!");r.undelegateEvents();var e=new Date;var t=e.getTime();r.model.save({last_update_type:"error",last_updated_time:t},{headers:{faculty_id:r.model.get("faculty_id")},error:function(){console.log("Error updating faculty log to server")},success:function(){console.log("Successfully updated faculty log to server")}})}})}}$(this.$el.find("#myModal")).modal("hide")},getDepartmentName:function(e){var t=app.Global.Department.findWhere({id:e.get("department_id")});var n=t.get("name");var r=e.get("semester_id")+n+"-"+e.get("section_name");return r},fetchEntryModel:function(e){var t=this;app.Global.showLoadingBar();e.fetch({error:function(e,t,n){app.Global.hideLoadingBar();console.log("Error fetching  period_entry collection from server...")},success:function(n,r,i){app.Global.hideLoadingBar();console.log("Successfully fetched data of period_entry from server.");t.addPeriodEntryBody(e)}})},destroy_view:function(){this.undelegateEvents();$(this.el).removeData().unbind();this.remove();var e=new Date;var t=e.getTime();this.model.set({last_updated_time:t,last_update_type:"error"});Backbone.View.prototype.remove.call(this)}});app.Views.faculty_entry=Backbone.View.extend({initialize:function(){this.childViews=[];this.template=_.template($("#faculty_home_log").html());this.listenTo(this.model,"change:last_updated_time",this.alertBoxClosed);this.listenTo(this.model,"change:info",this.render);this.detachIconsElement=null},beforeClose:function(){if(this.childViews){var e=this.childViews.length;for(var t=0;t<e;t++){this.childViews[t].destroy_view()}}},tagName:"li",events:{"click a#log-entry-edit":"editEntry","click a#log-entry-delete":"deleteEntry"},render:function(){this.$el.html(this.template(this.model.toJSON()));return this},alertBoxClosed:function(e,t,n){if((e.get("last_update_type")==="update"||e.get("last_update_type")==="error")&&this.detachIconsElement!==null){var r=this.$el.find("#log-icons-containers");$(r).append(this.detachIconsElement)}},editEntry:function(e){e.preventDefault();this.iconsElement=this.$el.find("#log-entry-edit, #log-entry-delete");this.detachIconsElement=$(this.iconsElement).detach();console.log("Editing the entry..");var t=new app.Views.logAlertBox({model:this.model});t.delete=0;this.childViews.push(t);this.$el.append(t.render().el);var n=this.$el.find("#myModal");console.log("showing the modal window..");$(n).modal("show")},deleteEntry:function(e){e.preventDefault();this.iconsElement=this.$el.find("#log-entry-edit, #log-entry-delete");this.detachIconsElement=$(this.iconsElement).detach();console.log("deleting the entry..");var t=new app.Views.logAlertBox({model:this.model});t.delete=1;this.childViews.push(t);this.$el.append(t.render().el)}});app.Views.activity=Backbone.View.extend({initialize:function(){app.Global.Router.currentView=this;this.childViews=[];this.listenTo(this.collection,"add",this.addOne);this.listenTo(this.collection,"reset",this.addAll);this.offset=0;this.limit=10;this.daysEntryRecord={};this.fetchMore();var e=this;$(window).scroll(_.debounce(function(){if($(window).scrollTop()+$(window).height()>$(document).height()-100){console.log("scroll position: near  bottom!");e.fetchMore()}},300))},beforeClose:function(){if(this.childViews){var e=this.childViews.length;for(var t=0;t<e;t++){this.childViews[t].destroy_view()}}},fetchMore:function(){var e=this;app.Global.showLoadingBar();this.collection.fetch({data:{offset:e.offset,limit:e.limit,faculty_id:faculty.id},remove:false,error:function(e,t,n){app.Global.hideLoadingBar();console.log("Error fetching collection from faculty_entry collection.")},success:function(t,n,r){app.Global.hideLoadingBar();console.log("Successfully fetched data of faculty_entry from server.");var i=n.length;e.offset=e.offset+i}})},addOne:function(e){var t=e.get("date");var n=getDay(t);var r=convertDate(t);if(this.daysEntryRecord[t]===undefined){var i=$('<div class="col-md-12 col-xs-12 "></div>');var s=$('<h4 class="log_day"></h4>');var o=$('<span class="log_date"></span>');var u=$('<ul class="jecrc-stats log"></ul>');i.append(s);$(this.$el).append(i);s.append(n);i.append(o);o.append(r);i.append(u);this.daysEntryRecord[t]=u}var a=new app.Views.faculty_entry({model:e});this.childViews.push(a);$(this.daysEntryRecord[t]).append(a.render().el)},addAll:function(){console.log("resetting  the log entry view...");this.collection.each(this.addOne,this)},render:function(){$(this.$el).empty();if(this.collection.length){this.addAll()}return this}})